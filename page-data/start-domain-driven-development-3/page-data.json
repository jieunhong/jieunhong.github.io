{"componentChunkName":"component---src-templates-blog-post-js","path":"/start-domain-driven-development-3/","result":{"data":{"site":{"siteMetadata":{"title":"지은이의 개발 Blog","author":"Jieun Hong"}},"markdownRemark":{"id":"6670ee5a-2a24-56bc-a6fb-829ba793dda4","html":"<h2 id=\"31-애그리거트\"><a href=\"#31-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.1 애그리거트</h2>\n<p>개별 객체 수준에서 모델을 바라보면 상위 수준에서 관계를 파악하기 어렵다. </p>\n<p>도메인 객체 모델이 복잡해지면 개별 구성요소 위주로 모델을 이해하게 되고, 전반적인 구조나 큰 수준에서 도메인 간의 관계를 파악하기 어려워진다. </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/09fc388e31c646371fcc506cecb33bce/6e9ba/0.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 60.810810810810814%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAAB3klEQVR42lVS2Y6jMBDk/39r9201LzswTEggCcQX2OCrbXOvSTSj2Vap1Op2yX0l+9O2J5uwvuMlJeuB6KDprVIpGtOv4F+8Cli/3yfbth94if2a0/WTbTnbCzYbbaRU1kJBxxg5se2Dbv1P8c+fbVhTumZ0S+lWsEUZR1oR+cymlO5R+U7+FyO50MF1ynPl6w5y7Co+n1nIkP9o9AmZvNEZCgX1ZTvGrLBzlK3PYpPfed9r3wvhwCJuBw0Y1dYoPEwADj9qcK6k1jkYRAcuKBj3L0tSFB4cqNCthJLourWnG7lTWWAb4xXiSMAJOywgIvpVG+5ivrah7KYkp9ON2abVMXFGqqLwEKERPmv0jUHDXeRP4m+di01dW8hqXVF7o/qtHJJfuYhlGy3nMdRM99KKjsUW7i04H6xWYZzO2Hjv5SBi2Xc6eGe9kYhDcmmnC9El6q9EXbCKbbMBaA8VsyWWFR4il/SIsMGRHj4f6vSIBZo/hUimeW2l472S+pj5sr62sCs3C2kI40LBa0jbE1wH3GnKZYFMEsYlpo1W3oGIimV9iaWdjDEEI2NhMOF7wsr6jneouccxJfOyneMBNTpH0IhpP+7tsN4uJxKyWkYW5tjtK6Fg4nqSbkHC/QPln6KE+7LjXgAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/09fc388e31c646371fcc506cecb33bce/fcda8/0.png\"\n        srcset=\"/static/09fc388e31c646371fcc506cecb33bce/12f09/0.png 148w,\n/static/09fc388e31c646371fcc506cecb33bce/e4a3f/0.png 295w,\n/static/09fc388e31c646371fcc506cecb33bce/fcda8/0.png 590w,\n/static/09fc388e31c646371fcc506cecb33bce/6e9ba/0.png 731w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>애그리거트는 관련된 객체를 하나의 군으로 묶는다.</p>\n<p>수 많은 객체를 애그리거트로 묶어서 바라보면 상위수준에서 도메인 모델 간의 관계 파악에 용이하다.</p>\n<ul>\n<li>모델의 이해에 도움을 줌.</li>\n<li>일관성을 관리하는 기준이 된다.</li>\n</ul>\n<p>애그리거트는 경계를 갖는다. 따라서 한 애그리거트에 속한 객체는 다른 애그리거트에 속하지 않는다.</p>\n<p>애그리거트는 독립된 객체 군이다.</p>\n<p>자기 자신을 관리할 뿐 다른 애그리거트를 관리하지 않는다. </p>\n<p>도메인 규칙과 요구사항이 경계를 설정할 때 기본이 된다. </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c5421e57f738a1b62c80699f3a0c2a5d/9d576/1.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 541px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 59.45945945945946%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAMCAIAAADtbgqsAAAACXBIWXMAAAsTAAALEwEAmpwYAAABGklEQVR42o2SYWuDMBCG/f//aV/KoPtQ1oF0Y+soXatrqtNojEmMd3ZvGyhsSO1h4Djvufd8TZQkidaamIWiVeoWm2a5bT+EL1s+TUUkpXTWKm1Xgp/W9cPzbhYfFl/uM2cehgm4bVvvPTLtSCjelYTnqKjr71Ae/o43xjjnTvdFhBN4c4mqquq6Vk3T9314pZSy1mIidoQ7/+GrJjPneY7uruvCtxBRwIQQGBR6RmBMBQNlwCFHEa1N04DJsgwV5OMw9oSIv8RVAWpBuSgK1LvOja99I7A8xo0bdgvj4Ueff94m92nFtaHgLrbABZmAE0nLhB9fs1n8PX8vX1I+SmPN2XZYOAFrx9uC4r2dr+u3g9tL8sRBGdb+Aj0JvIFoeaQlAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/c5421e57f738a1b62c80699f3a0c2a5d/9d576/1.png\"\n        srcset=\"/static/c5421e57f738a1b62c80699f3a0c2a5d/12f09/1.png 148w,\n/static/c5421e57f738a1b62c80699f3a0c2a5d/e4a3f/1.png 295w,\n/static/c5421e57f738a1b62c80699f3a0c2a5d/9d576/1.png 541w\"\n        sizes=\"(max-width: 541px) 100vw, 541px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>A가 B를 갖는다 라고 설계할 수 있는 요구사항이 있다면 A와 B가 한 애그리거트라고 생각되기 쉽다. </p>\n<p>예를 들어 상품과 상품리뷰의 경우, 상품이 상품 리뷰를 갖는다라고 생각할 수 있다. 하지만 실제 상품의 경우 관리자가 조작을 하고, 상품 리뷰의 경우 고객이 작성하게 된다. 생성 시점과 변경 주체가 다르기 때문에 서로 다른 애그리거트에 속한다.</p>\n<aside>\n💡 다수의 애그리거트가 한 개의 엔티티 객체만 갖는 경우가 많았으며, 두 개 이상의 엔티티로 구성되는 애그리거트는 드물었다.\n</aside>\n<hr>\n<h2 id=\"32-애그리거트-루트\"><a href=\"#32-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8-%EB%A3%A8%ED%8A%B8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2 애그리거트 루트</h2>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b9701422cad4f4fe4d012b1f5af596c2/1d180/2.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 405px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 91.8918918918919%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAASCAIAAADUsmlHAAAACXBIWXMAAAsTAAALEwEAmpwYAAABjUlEQVR42p2TW2+CQBCF9///MBPkwUQkCPIGJFy8goKI0n7lWB4qbdrOw2aYOefMhV3z9mJt2+52u3aw62BlWdZ1/Yo0r6Hb7QaUc7lcbjYbyf2BfLlccO73++Px+I7c9/0EGcLpdIJ/PB7pH+d8Pkvla2VyCFNtnLDrOuqoGio4TdPQBacAOOBJmaIo+OA8HA44aOFQs6qqPM/3+z0SVCYIWkwN5TiOIYH2bDabz+c4tAcOENqWZa1WK2YjHkURQRw4vu9DDsPQ8BvwttttlmUQ6BmytCmlPcGhF2pqI4yAg4TRbjAc0pzqmY7QlRCGKBENxRZBcn60TT+gGU8jQdYsUtTCtEUAUqdHVAwNC6fcuDA+GUSKBHFoREiknwvTh+u6XCYc5kmSRAuzbdvzPHB8xnFMfQZm1PV6TRD8c2H9YLpelNXCcJSFPC4MmC7Mc2EMDKj6tHE3BPWfMTpSthyMLPNOX0/IuuGaE/L09Zx8kmo4TVN2Rrdo/fZh6EnS52KxCILgn09SD+AH8jufLg8kM15KGAAAAABJRU5ErkJggg=='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Untitled\"\n        title=\"\"\n        src=\"/static/b9701422cad4f4fe4d012b1f5af596c2/1d180/2.png\"\n        srcset=\"/static/b9701422cad4f4fe4d012b1f5af596c2/12f09/2.png 148w,\n/static/b9701422cad4f4fe4d012b1f5af596c2/e4a3f/2.png 295w,\n/static/b9701422cad4f4fe4d012b1f5af596c2/1d180/2.png 405w\"\n        sizes=\"(max-width: 405px) 100vw, 405px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>애그리거트는 여러 객체로 구성되기 때문에 한 객체만 정상이면 안된다. </p>\n<p>도메인 규칙을 지키려면 애그리거트에 속한 모든 객체가 정상 상태를 가져야한다. </p>\n<p>애그리거트에 속한 모든 객체가 일관된 상태를 유지하려면 애그리거트 전체를 관리할 주체가 필요하다. 이 책임을 지는 것이 <strong>애그리거트의 루트 엔티티</strong>이다. </p>\n<p>애그리거트에 속한 객체는 루트 엔티티에 직접 또는 간접적으로 속하게 된다.</p>\n<h3 id=\"321-도메인-규칙과-일관성\"><a href=\"#321-%EB%8F%84%EB%A9%94%EC%9D%B8-%EA%B7%9C%EC%B9%99%EA%B3%BC-%EC%9D%BC%EA%B4%80%EC%84%B1\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2.1 도메인 규칙과 일관성</h3>\n<p>애그리거트 루트의 핵심 역할</p>\n<ul>\n<li>일관성이 깨지지 않도록 하는 것</li>\n<li>애그리거트가 제공해야할 도메인 기능을 구현한다.</li>\n</ul>\n<p>방법</p>\n<ul>\n<li>애그리거트 외부에서 애그리거트에 속한 객체를 직접 변경하면 안 된다. : 모델의 일관성을 깨는 원인</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">ShippingInfo</span> si <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getShipingInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\nsi<span class=\"token punctuation\">.</span><span class=\"token function\">setAddress</span><span class=\"token punctuation\">(</span>newAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>order의 주문 상태를 확인하여, 배송지 입력 가능 여부를 판단해야한다. 하지만 set 메서드로 주소를 바로 수정하게 되면 상태에 따른 입력 가능여부가 무시된다. 즉 논리적인 데이터 일관성이 깨지며 이는 모델의 일관성이 깨지는 것과 동일하다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token class-name\">ShippingInfo</span> si <span class=\"token operator\">=</span> order<span class=\"token punctuation\">.</span><span class=\"token function\">getShipingInfo</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\n<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>state <span class=\"token operator\">!=</span> <span class=\"token class-name\">OrderState</span><span class=\"token punctuation\">.</span>PAYMENT_WAITING <span class=\"token operator\">&amp;&amp;</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">IllegalArgumentException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span>\nsi<span class=\"token punctuation\">.</span><span class=\"token function\">setAddress</span><span class=\"token punctuation\">(</span>newAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span></code></pre></div>\n<p>상태 확인 로직을 넣어서 일관성을 지켜보려고 코딩할 수 있으나, 이는 다른 곳에서도 중복으로 구현할 가능성이 높기 때문에 유지보수에 도움이 되지 않다. <em>(오히려 관리 포인트만 늘어나게 된다.)</em></p>\n<p><strong>불필요한 중복을 피하고 애그리거트 루트를 통해서만 도메인 로직을 구현하는 법</strong></p>\n<ul>\n<li><strong>단순 변경 set 메서드를 public으로 만들지 않는다.</strong></li>\n</ul>\n<p>공개 set 메서드는 도메인의 의미나 의도를 표현하지 못하고, 도메인 객체가 아닌 영역으로 분산시킨다. </p>\n<p>따라서 유지보수와 분석에 더 많은 공수가 들어가게 된다. </p>\n<p>공개 set 메서드를 사용하지 않는다면, 의미가 드러나는 메서드를 사용해서 구현할 가능성이 높아진다. </p>\n<ul>\n<li><strong>밸류타입은 불변으로 구현한다.</strong></li>\n</ul>\n<p>밸류 객체의 값이 변경이 불가능하다면, 외부에서 밸류 객체의 상태를 변경할 수 없다. </p>\n<p>따라서 밸류 타입의 내부 상태를 변경하기 위해서는 애그리거트 루트를 통해서만 가능하다. </p>\n<h3 id=\"322-애그리거트-루트의-기능-구현\"><a href=\"#322-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8-%EB%A3%A8%ED%8A%B8%EC%9D%98-%EA%B8%B0%EB%8A%A5-%EA%B5%AC%ED%98%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2.2 애그리거트 루트의 기능 구현</h3>\n<p>애그리거트 루트는 애그리거트 내부의 다른 객체를 조합해서 기능을 완성한다.</p>\n<p>구성요소의 상태만 참조하는 것이 아니라, 기능 실행을 위임하기도 한다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Order</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">OrderLines</span> orderLines<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">changeOrderLines</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">OrderLine</span><span class=\"token punctuation\">></span></span> newLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\torderLines<span class=\"token punctuation\">.</span><span class=\"token function\">changeOrderLines</span><span class=\"token punctuation\">(</span>newLines<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">this</span><span class=\"token punctuation\">.</span>totalAmounts <span class=\"token operator\">=</span> orderLines<span class=\"token punctuation\">.</span><span class=\"token function\">getTotalAmounts</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n\n<span class=\"token punctuation\">}</span></code></pre></div>\n<blockquote>\n<p>만약 밸류 타입을 불변으로 구현할 수 없는 상황이라면 밸류 객체의 변경기능을 패키지나 protected 범위로 한정하여 외부에서 실행 할 수 없도록 제한할 수도 있다.</p>\n</blockquote>\n<h3 id=\"323-트랜잭션-범위\"><a href=\"#323-%ED%8A%B8%EB%9E%9C%EC%9E%AD%EC%85%98-%EB%B2%94%EC%9C%84\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.2.3 트랜잭션 범위</h3>\n<p><strong>트랜잭션 범위는 작을 수록 좋다.</strong></p>\n<ul>\n<li>성능에서의 차이가 발생한다. (여러 테이블을 수정할 수록 잠가야하는 대상이 늘어난다)</li>\n<li>\n<p>한 트랜잭션에서는 한 개의 애그리거트만 수정해야한다.</p>\n<ul>\n<li>애그리거트에서 다른 애그리거트를 변경하지 않는 것을 의미한다.</li>\n<li>애그리거트는 서로 독립적이어야 하는데 한 애그리거트가 다른 애그리거트의 기능에 의존하기 때문에 결합도가 높아진다.</li>\n</ul>\n</li>\n<li>한 트랜잭션에서 두 개 이상의 애그리거트를 수정해야 한다면, 응용서비스에서 두 애그리거트를 수정하도록 구현한다.</li>\n</ul>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ChangeOrderService</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token annotation punctuation\">@Transactional</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token keyword\">void</span> <span class=\"token function\">changeShippingInfo</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">OrderId</span> id<span class=\"token punctuation\">,</span> <span class=\"token class-name\">ShippingInfo</span> newInfo<span class=\"token punctuation\">,</span> <span class=\"token keyword\">boolean</span> isUse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">Order</span> order <span class=\"token operator\">=</span> orderRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\torder<span class=\"token punctuation\">.</span><span class=\"token function\">shipTo</span><span class=\"token punctuation\">(</span>newInfo<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>isUse<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token class-name\">Member</span> member <span class=\"token operator\">=</span> <span class=\"token function\">findMember</span><span class=\"token punctuation\">(</span>order<span class=\"token punctuation\">.</span>getOrderer<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t\tmember<span class=\"token punctuation\">.</span><span class=\"token function\">changeAddress</span><span class=\"token punctuation\">(</span>newInfo<span class=\"token punctuation\">.</span>getAddress<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>다음의 경우 한 트랜잭션에서 두 개 이상의 애그리거트를 변경하는 것을 고려할 수 있다.</p>\n<ul>\n<li><strong>팀 표준</strong> : 팀이나 조직의 표준에 따라 응용서비스의 기능을 한 트랙잭션에서 수행해야 할 경우</li>\n<li><strong>기술 제약</strong> : 기술적으로 이벤트 방식을 도입할 수 없는 경우, 한 트랜잭션에서 다수의 애그리거트를 수정해서 일관성을 처리</li>\n<li><strong>UI 구현의 편리</strong> :  사용자의 편리함을 위해 한 트랜잭션에서 여러 애그리거트의 상태를 변경할 수 있다.</li>\n</ul>\n<hr>\n<h2 id=\"33-리포지터리와-애그리거트\"><a href=\"#33-%EB%A6%AC%ED%8F%AC%EC%A7%80%ED%84%B0%EB%A6%AC%EC%99%80-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.3 리포지터리와 애그리거트</h2>\n<p>애그리거트는 개념상 완전한 한 개의 도메인 모델을 표현하므로 객체의 영속성을 처리하는 <strong>리포지터리는 애그리거트 단위로 존재한다.</strong> </p>\n<p>애그리거트는 개념적으로 하나이므로 리포지터리는 애그리거트 전체를 저장소에 영속화해야한다.  애그리거트를 저장할 때 애그리거트 루트와 매핑되는 테이블 뿐만 아니라 애그리거트에 속한 모든 구성요소에 매핑된 테이블에 데이터를 저장해야 한다. </p>\n<p>리포지터리는 완전한 애그리거트를 제공해야한다. : 그렇지 않으면 참조시 NullPointerException 발생</p>\n<hr>\n<h2 id=\"34-id를-이용한-애그리거트-참조\"><a href=\"#34-id%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8-%EC%B0%B8%EC%A1%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4 ID를 이용한 애그리거트 참조</h2>\n<p>애그리거트도 다른 애그리거트를 참조한다.</p>\n<p>애그리거트 간의 참조는 필드를 통해 구현 가능하다.</p>\n<p>하지만 필드를 이용한 애그리거트 참조의 문제 야기</p>\n<ul>\n<li>편한 탐색 오용 : 다른 애그리거트의 상태를 쉽게 변경할 수 있음, 의존 결합도 높임</li>\n<li>성능에 대한 고민 : 지연 로딩과 즉시 로딩을 결정해야함.</li>\n<li>확장 어려움 : 하위 도메인별로 시스템을 분리하게 된다면, JPA같은 단일 기술을 사용하기 어려움.</li>\n</ul>\n<p>이를 위한 방법 : ID를 이용해서 다른 애그리거트를 참조하자!</p>\n<p>ID참조를 이용하면 </p>\n<ul>\n<li>물리적인 연경을 제거하기 때문에 모델의 복잡도를 낮춘다.</li>\n<li>애그리거트간 의존을 제거하기 때문에 응집도를 높여주는 효과도 존재한다.</li>\n<li>구현 복잡도도 낮아진다. 지연/즉시 로딩에 대한 고민이 없어진다. (응용서비스에 ID로 알아서 로딩하면 됨)</li>\n<li>다른 애그리거트를 수정하는 문제를 근원적으로 방지할 수 있다.</li>\n<li>서로 다른 구현 기술을 사용 가능하다. (RDBMS든 NoSQL이든 ID로 검색만 하면 됨)</li>\n</ul>\n<h3 id=\"341-id를-이용한-참조와-조회-성능\"><a href=\"#341-id%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%9C-%EC%B0%B8%EC%A1%B0%EC%99%80-%EC%A1%B0%ED%9A%8C-%EC%84%B1%EB%8A%A5\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.4.1 ID를 이용한 참조와 조회 성능</h3>\n<p><strong>N+1문제</strong></p>\n<ul>\n<li>ID 참조를 하게되면 하위 데이터를 가져오기 위한 추가 쿼리 실행이 필요하다</li>\n<li>예를 들어 1개의 주문에 10개의 상품이 묶여있는 경우, 상품의 정보를 보기 위해서는 주문 find 1번, 상품 find 10 번 = 11번의 조회 쿼리가 필요하다.</li>\n<li>조회대상이 N개일 때 N개를 읽어오는 한 번의 쿼리와 연관된 데이터를 읽어오는 쿼리를 N번 실행한다.</li>\n<li>전체 조회 속도가 느려지는 원인.</li>\n<li>조인을 이용하면 개선 가능 : 가장 쉬운 방법은 ID 참조에서 객체참조로 변경하고 즉시로딩으로 변경하는 것. 하지만 기존의 참조를 이용한 애그리거트 문제로 다시 돌아가게 된다.</li>\n<li>\n<p>따라서 조회 전용 쿼리를 사용하면 된다.</p>\n<ul>\n<li>별도의 DAO를 만들고 조인을 이용한 한 번의 쿼리로 필요한 데이터를 로딩하면 된다.</li>\n</ul>\n</li>\n</ul>\n<p>애그리거트마다 서로 다른 저장소를 사용하면 한 번의 쿼리로 관련 애그리거트를 조회할 수 없다. 이때는 조회 성능을 높이기 위해 캐시를 적용하거나 조회 전용 저장소를 따로 구성한다. </p>\n<hr>\n<h2 id=\"35-애그리거트-간-집합-연관\"><a href=\"#35-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8-%EA%B0%84-%EC%A7%91%ED%95%A9-%EC%97%B0%EA%B4%80\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.5 애그리거트 간 집합 연관</h2>\n<p><strong>1:N, M:N 연관이 있는 경우(Collection)</strong></p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Category</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">Set</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products<span class=\"token punctuation\">;</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getProducts</span><span class=\"token punctuation\">(</span><span class=\"token keyword\">int</span> page<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> sortedProducts <span class=\"token operator\">=</span> <span class=\"token function\">sortById</span><span class=\"token punctuation\">(</span>products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> sortedProducts<span class=\"token punctuation\">.</span><span class=\"token function\">subList</span><span class=\"token punctuation\">(</span>page <span class=\"token operator\">-</span> <span class=\"token number\">1</span><span class=\"token punctuation\">)</span><span class=\"token operator\">*</span>size<span class=\"token punctuation\">,</span> page<span class=\"token operator\">*</span>size<span class=\"token punctuation\">)</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>페이징을 구현하기 위해서 카테고리 밑의 모든 product를 로딩 한 뒤, 사이즈를 자르는 방식은 product의 갯수가 많아질 수록 성능의 문제를 야기한다. </p>\n<p>따라서 개념적으로 1:N인 경우, N:1로 연관지어 생각한다. </p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">private</span> <span class=\"token class-name\">CategoryId</span> categoryId<span class=\"token punctuation\">;</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">ProductListService</span> <span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Page</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> <span class=\"token function\">getProductCategory</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">Long</span> categoryId<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> page<span class=\"token punctuation\">,</span> <span class=\"token keyword\">int</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token class-name\">Category</span> category <span class=\"token operator\">=</span> categoryRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findyId</span><span class=\"token punctuation\">(</span>categoryId<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">checkCategory</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">List</span><span class=\"token generics\"><span class=\"token punctuation\">&lt;</span><span class=\"token class-name\">Product</span><span class=\"token punctuation\">></span></span> products <span class=\"token operator\">=</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findByCategoryId</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">int</span> totalCount <span class=\"token operator\">=</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">countsByCategoryId</span><span class=\"token punctuation\">(</span>category<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Pagew</span><span class=\"token punctuation\">(</span>page<span class=\"token punctuation\">,</span> size<span class=\"token punctuation\">,</span> totalCount<span class=\"token punctuation\">,</span> products<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p><strong>M:N 연관은 개념적으로 양쪽 애그리거트에 컬렉션으로 연관을 만든다.</strong> </p>\n<p>개념적으로는 양방향 M:N 연관이 존재하지만, 실제 구현에서는 상품에서 카테고리로의 단방향 M:N연관만 적용하면 된다. </p>\n<p>RDBMS에서 M:N은 조인 테이블을 사용하여 구현한다. </p>\n<p>목록이나 상세화면과 같은 조회 기능은 조회 전용 모델을 이용해서 구현하는 것이 좋다.</p>\n<hr>\n<h2 id=\"36-애그리거트를-팩토리로-사용하기\"><a href=\"#36-%EC%95%A0%EA%B7%B8%EB%A6%AC%EA%B1%B0%ED%8A%B8%EB%A5%BC-%ED%8C%A9%ED%86%A0%EB%A6%AC%EB%A1%9C-%EC%82%AC%EC%9A%A9%ED%95%98%EA%B8%B0\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>3.6 애그리거트를 팩토리로 사용하기</h2>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">RegisterProductService</span><span class=\"token punctuation\">{</span>\n\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">ProductId</span> <span class=\"token function\">registerNewProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">NewProductReqeust</span> req<span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\n\t\t<span class=\"token class-name\">Store</span> store <span class=\"token operator\">=</span> storeRepository<span class=\"token punctuation\">.</span><span class=\"token function\">findById</span><span class=\"token punctuation\">(</span>req<span class=\"token punctuation\">.</span><span class=\"token function\">getStoreId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token function\">checkNull</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">if</span><span class=\"token punctuation\">(</span>store<span class=\"token punctuation\">.</span><span class=\"token function\">isBlocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StoreBlockedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token class-name\">ProductId</span> id <span class=\"token operator\">=</span> productRepository<span class=\"token punctuation\">.</span><span class=\"token function\">nextId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token class-name\">Product</span> product <span class=\"token operator\">=</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> store<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\tproductRepository<span class=\"token punctuation\">.</span><span class=\"token function\">save</span><span class=\"token punctuation\">(</span>product<span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token keyword\">return</span> id<span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>상점 상태가 차단이 아닌 경우에만 상품을 생성하는 로직이다. store의 block 여부를 판단하여 Product를 생성한다. 애그리거트별로 구현이 분리되어있다. 하지만</p>\n<p>중요한 도메인 로직 처리가 응용 서비스에 노출되었다.</p>\n<div class=\"gatsby-highlight\" data-language=\"java\"><pre class=\"language-java\"><code class=\"language-java\"><span class=\"token keyword\">public</span> <span class=\"token keyword\">class</span> <span class=\"token class-name\">Store</span><span class=\"token punctuation\">{</span>\n\t<span class=\"token keyword\">public</span> <span class=\"token class-name\">Product</span> <span class=\"token function\">createProduct</span><span class=\"token punctuation\">(</span><span class=\"token class-name\">ProductId</span> id<span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span> <span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t<span class=\"token keyword\">if</span> <span class=\"token punctuation\">(</span><span class=\"token operator\">!</span>account<span class=\"token punctuation\">.</span><span class=\"token function\">isBlocked</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">)</span> <span class=\"token punctuation\">{</span>\n\t\t\t<span class=\"token keyword\">throw</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">StoreBlockedException</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t\t<span class=\"token punctuation\">}</span>\n\t\t<span class=\"token keyword\">return</span> <span class=\"token keyword\">new</span> <span class=\"token class-name\">Product</span><span class=\"token punctuation\">(</span>id<span class=\"token punctuation\">,</span> account<span class=\"token punctuation\">.</span><span class=\"token function\">getId</span><span class=\"token punctuation\">(</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">,</span> <span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">.</span><span class=\"token punctuation\">)</span><span class=\"token punctuation\">;</span>\n\t<span class=\"token punctuation\">}</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>Store 안에서 Product를 생성하게 된다면 상태 판단 이후 생성하는 주요 로직이 노출되지 않게 된다.  createProduct()는 Product의 생성 팩토리 역할이 된다. </p>\n<p>애그리거트가 갖고 있는 데이터를 이용해서 다른 애그리거트를 생성해야 한다면 애그리거트에 팩토리 메서드를 구현하는 것을 고려해보자, </p>\n<p>또는 애그리거트를 직접 생성하지 않고 다른 팩토리에 위임하는 방법도 있다.</p>\n<p>질문 : 같은 도메인이면 다른 애그리거트여도 자신이 아닌 다른 곳에서 생성이 가능한건가 ??????? 이해가 안된다.</p>","timeToRead":8,"frontmatter":{"title":"도메인 주도 개발 시작하기 3장 - 애그리거트","date":"January 26, 2024","spoiler":"","cta":"DDD"},"fields":{"slug":"/start-domain-driven-development-3/","langKey":"en"}}},"pageContext":{"slug":"/start-domain-driven-development-3/","previous":{"fields":{"slug":"/start-domain-driven-development-2/","langKey":"en","directoryName":"start-domain-driven-development-2"},"frontmatter":{"title":"도메인 주도 개발 시작하기 2장 - 아키텍쳐 개요"}},"next":{"fields":{"slug":"/start-domain-driven-development-4/","langKey":"en","directoryName":"start-domain-driven-development-4"},"frontmatter":{"title":"도메인 주도 개발 시작하기 4장 - 리포지터리와 모델구현"}},"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}