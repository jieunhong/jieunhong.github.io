{"componentChunkName":"component---src-templates-blog-post-js","path":"/aws-s3-presigned-url-cors-error/","result":{"data":{"site":{"siteMetadata":{"title":"지은이의 개발 Blog","author":"Jieun Hong"}},"markdownRemark":{"id":"d14eee07-3c62-52f9-ab5d-05b38ddcc98d","html":"<p>+++++++</p>\n<h3 id=\"회사에서-프로젝트를-진행하던-중\"><a href=\"#%ED%9A%8C%EC%82%AC%EC%97%90%EC%84%9C-%ED%94%84%EB%A1%9C%EC%A0%9D%ED%8A%B8%EB%A5%BC-%EC%A7%84%ED%96%89%ED%95%98%EB%8D%98-%EC%A4%91\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>회사에서 프로젝트를 진행하던 중,</h3>\n<h3 id=\"대용량-파일을-업로드-해야하는-일이-발생하였다\"><a href=\"#%EB%8C%80%EC%9A%A9%EB%9F%89-%ED%8C%8C%EC%9D%BC%EC%9D%84-%EC%97%85%EB%A1%9C%EB%93%9C-%ED%95%B4%EC%95%BC%ED%95%98%EB%8A%94-%EC%9D%BC%EC%9D%B4-%EB%B0%9C%EC%83%9D%ED%95%98%EC%98%80%EB%8B%A4\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>대용량 파일을 업로드 해야하는 일이 발생하였다.</h3>\n<p>우리는 NCP의 Object Storage를 쓰고있었고, Java + Spring Boot를 이용해 aws SDK를 사용하던 중이었다.<br>\n해당 부분을 담당하던 팀원은 Presigned Url을 생성하여 파일을 업로드 하는 기능을 채택하였고, 작업은 아래 우형 기술 블로그를 참조하여 개발되었다. </p>\n<ul>\n<li><strong>Presigned Url 업로드 기능 설명</strong></li>\n</ul>\n<p><a href=\"https://api.ncloud-docs.com/docs/storage-objectstorage-uploadpart\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://api.ncloud-docs.com/docs/storage-objectstorage-uploadpart</a></p>\n<p><a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/s3_example_s3_Scenario_PresignedUrl_section.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.aws.amazon.com/AmazonS3/latest/API/s3_example_s3_Scenario_PresignedUrl_section.html</a></p>\n<ul>\n<li><strong>Spring Boot에서 S3에 파일을 업로드하는 세 가지 방법</strong></li>\n</ul>\n<p><a href=\"https://techblog.woowahan.com/11392/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://techblog.woowahan.com/11392/</a></p>\n<p>곧 담당 팀원이 외부 파견을 나갔고..  담당자는 내가 되었다. 그리고 해당 API를 프론트에서 호출하는 중에 에러가 발생하였다.</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/b1945/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjElEQVR42iXFOwuCUACAUf+8Qw0NDRZ2A+m1NNYogZiJj4tWWKn5Glyi//ClORyOcg8lxmzOdDRmoqpY5ommqGjLijp/U2c5bVVjHo4YmsZOLNn2FmIgBBtdZ79akyYPlDKKCVwPx7I52w6RjHjGN5r4Sh6EVN2foqTsTi4uqR+QScnL9wdef/D3LQp+b12DGEEvR9kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/fcda8/image.png\"\n        srcset=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/12f09/image.png 148w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/e4a3f/image.png 295w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/fcda8/image.png 590w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/efc66/image.png 885w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/c83ae/image.png 1180w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/b1945/image.png 2754w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">Access to XMLHttpRequest at <span class=\"token string\">'https:/(중략).kr.object.ncloudstorage.com/(생략)'</span> <span class=\"token keyword\">from</span> origin <span class=\"token string\">'http://localhost:5173'</span> has been blocked by <span class=\"token constant\">CORS</span> policy<span class=\"token operator\">:</span> No <span class=\"token string\">'Access-Control-Allow-Origin'</span> header is present on the requested resource<span class=\"token punctuation\">.</span></code></pre></div>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/0f1014e23f713444237ca7007fb5b3ba/2e195/image%201.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 112.83783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/0f1014e23f713444237ca7007fb5b3ba/fcda8/image%201.png\"\n        srcset=\"/static/0f1014e23f713444237ca7007fb5b3ba/12f09/image%201.png 148w,\n/static/0f1014e23f713444237ca7007fb5b3ba/e4a3f/image%201.png 295w,\n/static/0f1014e23f713444237ca7007fb5b3ba/fcda8/image%201.png 590w,\n/static/0f1014e23f713444237ca7007fb5b3ba/2e195/image%201.png 782w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>뭔지도 모르는데 일단 디버깅을 시작한 나.. </p>\n<p>에러 내용을 보면 알 수 있듯이 우리 서버를 호출하는 것이 아닌 이전에 서버에서 NCP를 통해 생성한 Presigned URL을 호출할 때 CORS가 발생하였다.</p>\n<p>아무래도 프론트에서 인증없이 호출하고 있었기 때문에 <em>‘Object Storage에 Cors를 설정해야겠다.’</em> 생각하였고, 마침 참고 했었던 블로그에 CORS 설정을 해야한다는 이야기가 있었기 때문에 그대로 시도했다. </p>\n<h2 id=\"aws-cli를-이용하여-bucket의-cors-설정-하는-방법\"><a href=\"#aws-cli%EB%A5%BC-%EC%9D%B4%EC%9A%A9%ED%95%98%EC%97%AC-bucket%EC%9D%98-cors-%EC%84%A4%EC%A0%95-%ED%95%98%EB%8A%94-%EB%B0%A9%EB%B2%95\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>AWS CLI를 이용하여 Bucket의 CORS 설정 하는 방법</h2>\n<p> NCP가 AWS CLI와 SDK를 호환하고 있다.</p>\n<ol>\n<li><strong>Cors 설정 파일을 작성한다.</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">hongjieun@hongjieunkkeo ~ % <span class=\"token function\">vi</span> cors-config.json</code></pre></div>\n<p>Presigned URL 생성시 PUT 메서드를 받는 URL을 만들겠다고 설정해서\nMethod에는 PUT을 넣어주었다. </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"CORSRules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"AllowedHeaders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"*\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"AllowedMethods\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"AllowedOrigins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"*\"</span>\n                <span class=\"token comment\">//원래 실제 호출하는 주소를 넣어야 함.</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ExposeHeaders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"ETag\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"MaxAgeSeconds\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<ol start=\"2\">\n<li><strong>만들어진 Cors 설정 파일을 AWS CLI를 이용해 설정한다.</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">hongjieun@hongjieunkkeo <span class=\"token operator\">~</span> <span class=\"token operator\">%</span> aws configure</code></pre></div>\n<p>계정 설정 먼저 진행한다 (accesskey/password)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">hongjieun@hongjieunkkeo <span class=\"token operator\">~</span> <span class=\"token operator\">%</span> aws <span class=\"token operator\">--</span>endpoint<span class=\"token operator\">-</span>url<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>kr<span class=\"token punctuation\">.</span>object<span class=\"token punctuation\">.</span>ncloudstorage<span class=\"token punctuation\">.</span>com s3api put<span class=\"token operator\">-</span>bucket<span class=\"token operator\">-</span>cors <span class=\"token operator\">--</span><span class=\"token function\">bucket</span> <span class=\"token punctuation\">(</span>여러분의 버킷 명을 입력하세요<span class=\"token punctuation\">)</span> <span class=\"token operator\">--</span>cors<span class=\"token operator\">-</span>configuration file<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>cors<span class=\"token operator\">-</span>config<span class=\"token punctuation\">.</span>json</code></pre></div>\n<p>조금 전에 만든 파일을 업데이트 한다. </p>\n<p>(이때 계정의 권한이 없거나 잘못된 버킷을 입력하면 에러메세지가 나온다~)\n(추가적으로 endpoint-url 은 aws는 aws의 url 로 입력해주어야 한다)</p>\n<ol start=\"3\">\n<li><strong>제대로 올라갔는지 확인한다.</strong></li>\n</ol>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">hongjieun@hongjieunkkeo <span class=\"token operator\">~</span> <span class=\"token operator\">%</span> aws <span class=\"token operator\">--</span>endpoint<span class=\"token operator\">-</span>url<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>kr<span class=\"token punctuation\">.</span>object<span class=\"token punctuation\">.</span>ncloudstorage<span class=\"token punctuation\">.</span>com s3api get<span class=\"token operator\">-</span>bucket<span class=\"token operator\">-</span>cors <span class=\"token operator\">--</span><span class=\"token function\">bucket</span> <span class=\"token punctuation\">(</span>여러분의 버킷 명을 입력하세요<span class=\"token punctuation\">)</span></code></pre></div>\n<p>해당 명령어를 입력하면 버킷에 설정한 Cors 설정 정보를 알 수 있다. </p>\n<p>이제 문제가 없으니, 프론트 분께 재시도를 요청드렸다.</p>\n<p>결과는 … 아직도 동일한 CORS 에러..!!!!!!!!!!!!!!!!</p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/b1945/image.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 8.783783783783782%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAACCAYAAABYBvyLAAAACXBIWXMAABYlAAAWJQFJUiTwAAAAjElEQVR42iXFOwuCUACAUf+8Qw0NDRZ2A+m1NNYogZiJj4tWWKn5Glyi//ClORyOcg8lxmzOdDRmoqpY5ommqGjLijp/U2c5bVVjHo4YmsZOLNn2FmIgBBtdZ79akyYPlDKKCVwPx7I52w6RjHjGN5r4Sh6EVN2foqTsTi4uqR+QScnL9wdef/D3LQp+b12DGEEvR9kAAAAASUVORK5CYII='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/fcda8/image.png\"\n        srcset=\"/static/b8bde8ad7e8feb17e1b74d5fa9991b11/12f09/image.png 148w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/e4a3f/image.png 295w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/fcda8/image.png 590w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/efc66/image.png 885w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/c83ae/image.png 1180w,\n/static/b8bde8ad7e8feb17e1b74d5fa9991b11/b1945/image.png 2754w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p>흑 인프라팀에 요청해서 CORS 설정 넣는 것도 꽤 대기 했는데 해결이 되지 않아 마음이 쓰렸다. </p>\n<p>모든 설정에는 문제가 없는데 대체 뭐가 문제일까 여러 방면으로 디버깅을 진행하였다. </p>\n<ul>\n<li><strong>Presigned URL 생성 부분에서 문제가 있나 싶어 백엔드 코드를 확인해보고,</strong></li>\n<li><strong>URL이 유효한가? POSTMAN으로 찔러도 보고.. (Cors는 브라우저가 내는 에러이기 때문에 성공했다. 다만 적어도 기능 상에 문제가 없다는 것을 알게되었다.)</strong></li>\n<li><strong>나중에는 CORS 설정 권한을 직접 받아서 CORS 설정 파일의 내용을 바꾸면서 테스트를 진행했다.</strong></li>\n</ul>\n<p><strong>CORS 에러는 Preflight 요청에서 발생한다.</strong></p>\n<p><strong>Preflight 요청은 OPTIONS 메서드로 실행된다.</strong> </p>\n<p><strong>그래서 Cors 설정 파일에 OPTIONS 메서드를 추가해보기로 했다.</strong> </p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\"><span class=\"token punctuation\">{</span>\n    <span class=\"token string\">\"CORSRules\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n        <span class=\"token punctuation\">{</span>\n            <span class=\"token string\">\"AllowedHeaders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"*\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"AllowedMethods\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"PUT\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"OPTIONS\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"GET\"</span><span class=\"token punctuation\">,</span> <span class=\"token string\">\"POST\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"AllowedOrigins\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"*\"</span>\n                <span class=\"token comment\">//원래 실제 호출하는 주소를 넣어야 함.</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"ExposeHeaders\"</span><span class=\"token operator\">:</span> <span class=\"token punctuation\">[</span>\n                <span class=\"token string\">\"ETag\"</span>\n            <span class=\"token punctuation\">]</span><span class=\"token punctuation\">,</span>\n            <span class=\"token string\">\"MaxAgeSeconds\"</span><span class=\"token operator\">:</span> <span class=\"token number\">3000</span>\n        <span class=\"token punctuation\">}</span>\n    <span class=\"token punctuation\">]</span>\n<span class=\"token punctuation\">}</span></code></pre></div>\n<p>AllowedMethods에 OPTIONS를 추가했다. (무지성으로 다른 메서드도 다 넣어봤다.)</p>\n<div class=\"gatsby-highlight\" data-language=\"jsx\"><pre class=\"language-jsx\"><code class=\"language-jsx\">hongjieun@hongjieunkkeo <span class=\"token operator\">~</span> <span class=\"token operator\">%</span> aws <span class=\"token operator\">--</span>endpoint<span class=\"token operator\">-</span>url<span class=\"token operator\">=</span>https<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>kr<span class=\"token punctuation\">.</span>object<span class=\"token punctuation\">.</span>ncloudstorage<span class=\"token punctuation\">.</span>com s3api put<span class=\"token operator\">-</span>bucket<span class=\"token operator\">-</span>cors <span class=\"token operator\">--</span><span class=\"token function\">bucket</span> <span class=\"token punctuation\">(</span>여러분의 버킷 명을 입력하세요<span class=\"token punctuation\">)</span> <span class=\"token operator\">--</span>cors<span class=\"token operator\">-</span>configuration file<span class=\"token operator\">:</span><span class=\"token operator\">/</span><span class=\"token operator\">/</span>cors<span class=\"token operator\">-</span>config<span class=\"token punctuation\">.</span>json\n\nAn error <span class=\"token function\">occurred</span> <span class=\"token punctuation\">(</span>InvalidRequest<span class=\"token punctuation\">)</span> when calling the PutBucketCors operation<span class=\"token operator\">:</span> <span class=\"token constant\">OPTIONS</span> is not an accepted AllowedMethod <span class=\"token keyword\">for</span> <span class=\"token constant\">CORS</span> configurations</code></pre></div>\n<p>그리고 적용하려고 보니 웬걸.. Cors 설정 파일에 OPTIONS 메서드를 지원하지 않는다.</p>\n<p>(억울)</p>\n<p>그럼 CORS 에러 해결 못하나 ? </p>\n<p><strong>다시 생각해보자.</strong> </p>\n<p><strong>Preflight OPTIONS 요청이 왜 가지? (이것이 포인트다)</strong></p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/bcd4463b4f623daddca6235ff7105ee3/692d4/image%202.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 398px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAABQAAAAPCAYAAADkmO9VAAAACXBIWXMAABYlAAAWJQFJUiTwAAADQklEQVR42n2SbUxTVxiA7y2M6RwGgyOLM0uWLbos8b/+IYtbFsOyP/7YAgvJFiZC+fBjsammBBFR6RXUiMVF0EaGooLggNJZRCgg8iFmE+kksMpE0YQ4FAIt9Pbx9JZWtrC9ycnJed/zPu+n5Pf7CRxVVQmI1+tBMeq5mvcdQ5cLGLdbeNxwnIe1Cv3luznxQzy5+iRUvxr2C9xB3zkkFiSkfDn1gsIdSVzbn8zt0r0MXVEYv25h4GI+dnMqP6XGY0z6jJmZmbBfGDgngCFFGPhikoqCTHrP7MNqyqLqYBYjV800Kjsxp39LTU4iStoXjI+5g8DFGc5pGS4AF0oeveOkyZyF6+Ih+iqKuFt5FFeFid4yEz1nC+koyaYsbTO9NeXaf9Xn+3/g03tddBzNZrhGYbaznCf1xdwr38Nti57JX0twnTdRsS2e4Zu1/wX8Vx9mpvj95yLuW/N4XHecoaoC7p4x0l36I64LB+gsTqfFYmJ2enLpHga1/zTMTv3Nb5VF3CrOFCUa6T9moOVQBvYjqdjzU3j+bCzcv8UDDQIDoEWR1Pl5zTgx6uLOuQP0n8tl4Hy+mLgB2+FtDLbWaXaf14vfpy495cXRQjL9aByHQY9T0eMqy6WtMI3TqZ8y4LQx73/9T5uyulQPA1HFPflghGGLlbZ1m2h49wO6le205yWJQaVQZUjAunML9pRkBgtPMjH4INQxDRzM0BfM7OG1Jto3JtCyaj3N0nJuSNE0SivpydjKyKUc/ryQg+NIYA+3UrfmHRokCfuK1fRl7MIz69UYHo8nWHIA2fN5IjcFxCnH4oxcxQ3dSuoj3+a+ks5og5mBswbaj32PdeOHXJIicERF0SHJIqiEY3MCL/8aE63wB0uenpig66N4uqU1dEXE0qGLpkmKpHF1LG6xd+5qsS6lmdTv/xpLzHIqBcSm09EWOG+uoFq8e3fv0UrXgE+d3bRGvk+XHEenLkZAo7GJTy2bNvCo9qDYw2x+yf0Gy8fvcVroq3UyTbKwyzocbyzTym//8is8IeCQYqFViqFHZNcpvyUiLxNAHX3GRP6o2kezkkzJJ2s5JRxrBcwuy9gE0CFue0SUFvxKXBzP3G5eAUYDoK7qq2hRAAAAAElFTkSuQmCC'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/bcd4463b4f623daddca6235ff7105ee3/692d4/image%202.png\"\n        srcset=\"/static/bcd4463b4f623daddca6235ff7105ee3/12f09/image%202.png 148w,\n/static/bcd4463b4f623daddca6235ff7105ee3/e4a3f/image%202.png 295w,\n/static/bcd4463b4f623daddca6235ff7105ee3/692d4/image%202.png 398w\"\n        sizes=\"(max-width: 398px) 100vw, 398px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests</a></p>\n<p>Preflight가 나가지 않는 요청을 <strong>Simple Requests</strong> 라고 한다. </p>\n<p>가능한 조건은 아래와 같다. </p>\n<blockquote>\n<ul>\n<li>\n<p>One of the allowed methods:</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/GET\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">GET</code></a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/HEAD\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">HEAD</code></a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Methods/POST\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">POST</code></a></li>\n</ul>\n</li>\n<li>\n<p>Apart from the headers automatically set by the user agent (for example, <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Connection\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Connection</code></a>, <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/User-Agent\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">User-Agent</code></a>, or <a href=\"https://fetch.spec.whatwg.org/#forbidden-header-name\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">the other headers defined in the Fetch spec as a <em>forbidden header name</em></a>), the only headers which are allowed to be manually set are <a href=\"https://fetch.spec.whatwg.org/#cors-safelisted-request-header\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">those which the Fetch spec defines as a CORS-safelisted request-header</a>, which are:</p>\n<ul>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Accept</code></a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Accept-Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Accept-Language</code></a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Language\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Content-Language</code></a></li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Content-Type</code></a> (please note the additional requirements below)</li>\n<li><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Range\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Range</code></a> (only with a <a href=\"https://fetch.spec.whatwg.org/#simple-range-header-value\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">simple range header value</a>; e.g., <code class=\"language-text\">bytes=256-</code> or <code class=\"language-text\">bytes=127-255</code>)</li>\n</ul>\n</li>\n<li>\n<p>The only type/subtype combinations allowed for the <a href=\"https://developer.mozilla.org/en-US/docs/Glossary/MIME_type\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">media type</a> specified in the <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Type\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">Content-Type</code></a> header are:</p>\n<ul>\n<li><code class=\"language-text\">application/x-www-form-urlencoded</code></li>\n<li><code class=\"language-text\">multipart/form-data</code></li>\n<li><code class=\"language-text\">text/plain</code></li>\n</ul>\n</li>\n<li>If the request is made using an <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">XMLHttpRequest</code></a> object, no event listeners are registered on the object returned by the <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest/upload\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">XMLHttpRequest.upload</code></a> property used in the request; that is, given an <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/XMLHttpRequest\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">XMLHttpRequest</code></a> instance <code class=\"language-text\">xhr</code>, no code has called <code class=\"language-text\">xhr.upload.addEventListener()</code> to add an event listener to monitor the upload.</li>\n<li>No <a href=\"https://developer.mozilla.org/en-US/docs/Web/API/ReadableStream\" target=\"_blank\" rel=\"nofollow noopener noreferrer\"><code class=\"language-text\">ReadableStream</code></a> object is used in the request.</li>\n</ul>\n</blockquote>\n<p>간단하게 정리하면, <strong>GET/HEAD/POST 메서드 요청이고, 기본 헤더(아래 명시된)만 사용하여 요청을 보낼 경우 Simple Requests가 될 수 있다고 한다.</strong> </p>\n<p>PUT을 쓰는 우리는 당연히 Preflight 요청이 나갈거고, OPTIONS 메서드를 허용하지 않는 AWS or NCP는 CORS 에러를 발생시킬 것이다. </p>\n<p>근데 이상하다? 우리가 참조한 블로그의 예제와 AWS의 Sample Code에는 PUT 메서드로 Presigned URL을 생성하는데 문제 없이 클라이언트에서 요청이 성공하고 있었다. </p>\n<p><code class=\"language-text\">( AWS SDK의 generatePresignedUrl 을 이용하여 URL을 생성하는 예제 코드)</code></p>\n<p><a href=\"https://github.com/awsdocs/aws-doc-sdk-examples/blob/main/java/example_code/s3/src/main/java/aws/example/s3/GeneratePresignedUrlAndUploadObject.java\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://github.com/awsdocs/aws-doc-sdk-examples/blob/main/java/example_code/s3/src/main/java/aws/example/s3/GeneratePresignedUrlAndUploadObject.java</a></p>\n<p>무슨 차이가 있지 ??</p>\n<p>그때 프론트 개발자 분이 나를 불렀다. </p>\n<blockquote>\n<p>성공했어요</p>\n</blockquote>\n<blockquote>\n<p>???? 대체 어떻게… ????</p>\n</blockquote>\n<p>그렇다. 프론트에서 기본적으로 인증을 위해 Header에 Authorization을 넣는 공통 요청함수를 만들었고.  </p>\n<p>AWS API 통신도 공통 함수로 호출 했던 것이었다.</p>\n<p>Authorization은 인증을 위한 대표적인 헤더로, 민감성 정보기 때문에 Preflight 요청을 무적권(아닐지도..)보낸다. </p>\n<p>하지만 PreSigned URL API에는 Authorization을 필요로 하지 않는다.</p>\n<p>프론트 개발자 분께서는 Header 에 Authorization을 제거한 함수를 개별로 생성해서 해당 함수로 호출하니 Preflight 요청 없이 바로 PUT API를 부른 것이었다!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!!1</p>\n<p><strong>유레카</strong></p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/6e777ae06b994f760098be77694c65be/e2310/image%203.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 150.67567567567568%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/6e777ae06b994f760098be77694c65be/fcda8/image%203.png\"\n        srcset=\"/static/6e777ae06b994f760098be77694c65be/12f09/image%203.png 148w,\n/static/6e777ae06b994f760098be77694c65be/e4a3f/image%203.png 295w,\n/static/6e777ae06b994f760098be77694c65be/fcda8/image%203.png 590w,\n/static/6e777ae06b994f760098be77694c65be/efc66/image%203.png 885w,\n/static/6e777ae06b994f760098be77694c65be/e2310/image%203.png 968w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<aside>\n💡\n<p><strong>5줄 정리</strong> </p>\n<ol>\n<li>NCP Cors 설정에서 method 중 OPTIONS method 타입은 지원하지 않고 있음</li>\n<li>프론트에서는 api를 보낼때 인증용 Authorization 헤더를 공통적으로 보내고 있었음</li>\n<li>Authorization 헤더와 같은 민감 헤더가 포함된 경우, 브라우저에서 preflight 요청을 보냄</li>\n<li>따라서 모든 method와 origin을 허용해도 preflight로 보내는 OPTIONS 요청에서 cors 에러가 발생</li>\n<li>공통적으로 사용하는 요청 함수를 분리하여 header에 Authorization 헤더를 제거하고 요청하니 Preflight 요청 없이 성공</li>\n</ol>\n</aside>\n<p>충분히 좀 더 빠르게 해결 할 수 있었는데 OPTIONS 메서드를 허용하지 않는다는 에러 메서지를 간과한 것이 디버깅 지연 원인이 되었다.</p>\n<p><em><del>블로그에는 차분하게 글을 정리해두었지만, 현실에서는 냅다 이것저것 넣고 빼고 쇼를 했다.</del></em> </p>\n<p>대신 다음부터는 CORS Preflight 이슈에 더 빠르게 대응할 수 있을 것 같다는 생각이 든다. </p>\n<p>까먹지 말라고 오랜만에 블로그 글까지 쓰니까…</p>\n<hr>\n<p>같이 디버깅 해준 프론트 개발자 H님과</p>\n<p>정확한 원인을 찾을 수 있도록 지식을 공유해주신 J님께 감사하다는 말을 남기고 싶습니다.</p>\n<p>따봉 J님 H님 고마워요~! </p>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/c53da03f2ec2088b4ae1e3e9584959f4/8c557/image%204.png\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 120.27027027027026%; position: relative; bottom: 0; left: 0; background-image: url('data:image/png;base64,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'); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"image.png\"\n        title=\"\"\n        src=\"/static/c53da03f2ec2088b4ae1e3e9584959f4/fcda8/image%204.png\"\n        srcset=\"/static/c53da03f2ec2088b4ae1e3e9584959f4/12f09/image%204.png 148w,\n/static/c53da03f2ec2088b4ae1e3e9584959f4/e4a3f/image%204.png 295w,\n/static/c53da03f2ec2088b4ae1e3e9584959f4/fcda8/image%204.png 590w,\n/static/c53da03f2ec2088b4ae1e3e9584959f4/8c557/image%204.png 700w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>\n<hr>\n<h2 id=\"참고-사이트\"><a href=\"#%EC%B0%B8%EA%B3%A0-%EC%82%AC%EC%9D%B4%ED%8A%B8\" aria-hidden class=\"anchor\"><svg aria-hidden=\"true\" height=\"16\" version=\"1.1\" viewBox=\"0 0 16 16\" width=\"16\"><path fill-rule=\"evenodd\" d=\"M4 9h1v1H4c-1.5 0-3-1.69-3-3.5S2.55 3 4 3h4c1.45 0 3 1.69 3 3.5 0 1.41-.91 2.72-2 3.25V8.59c.58-.45 1-1.27 1-2.09C10 5.22 8.98 4 8 4H4c-.98 0-2 1.22-2 2.5S3 9 4 9zm9-3h-1v1h1c1 0 2 1.22 2 2.5S13.98 12 13 12H9c-.98 0-2-1.22-2-2.5 0-.83.42-1.64 1-2.09V6.25c-1.09.53-2 1.84-2 3.25C6 11.31 7.55 13 9 13h4c1.45 0 3-1.69 3-3.5S14.5 6 13 6z\"></path></svg></a>참고 사이트</h2>\n<p><a href=\"https://api.ncloud-docs.com/docs/storage-objectstorage-uploadpart\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://api.ncloud-docs.com/docs/storage-objectstorage-uploadpart</a></p>\n<p><a href=\"https://docs.aws.amazon.com/AmazonS3/latest/API/s3_example_s3_Scenario_PresignedUrl_section.html\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://docs.aws.amazon.com/AmazonS3/latest/API/s3_example_s3_Scenario_PresignedUrl_section.html</a></p>\n<p><a href=\"https://techblog.woowahan.com/11392/\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://techblog.woowahan.com/11392/</a></p>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://developer.mozilla.org/en-US/docs/Web/HTTP/CORS#simple_requests</a></p>\n<p><a href=\"https://velog.io/@jh100m1/CORS-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%AD%94%EB%8D%B0-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EA%B2%B0%ED%95%98%EB%8A%94%EA%B1%B4%EB%8D%B0\" target=\"_blank\" rel=\"nofollow noopener noreferrer\">https://velog.io/@jh100m1/CORS-%EC%97%90%EB%9F%AC%EA%B0%80-%EB%AD%94%EB%8D%B0-%EC%96%B4%EB%96%BB%EA%B2%8C-%ED%95%B4%EA%B2%B0%ED%95%98%EB%8A%94%EA%B1%B4%EB%8D%B0</a></p>","timeToRead":9,"frontmatter":{"title":"Presigned URL Upload 403 CORS 발생 Error (With. AWS S3, NCP Object storage)","date":"January 07, 2025","spoiler":"Presigned URL 업로드 CORS 에러 : Preflight를 조심해","cta":"CORS"},"fields":{"slug":"/aws-s3-presigned-url-cors-error/","langKey":"en"}}},"pageContext":{"slug":"/aws-s3-presigned-url-cors-error/","previous":{"fields":{"slug":"/invalid-http-method-patch/","langKey":"en","directoryName":"invalid-http-method-patch"},"frontmatter":{"title":"Feign에서 PATCH method 에러 이유 (Invalid HTTP method: PATCH)"}},"next":null,"translations":[],"translatedLinks":[]}},"staticQueryHashes":["336482444"]}